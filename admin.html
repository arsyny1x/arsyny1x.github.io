<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - arsyny1x</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>body { font-family: 'Inter', sans-serif; }</style>
</head>
<body class="bg-gray-950 text-gray-100 min-h-screen">
  
  <!-- Login Screen -->
  <div id="login-screen" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-950">
    <div class="w-full max-w-md p-8 rounded-2xl bg-gray-900 border border-gray-800">
      <div class="text-center mb-8">
        <div class="w-16 h-16 mx-auto mb-4 rounded-xl bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center">
          <span class="text-white font-bold text-2xl">A</span>
        </div>
        <h1 class="text-2xl font-bold text-white">Admin Login</h1>
        <p class="text-gray-400 text-sm mt-2">Enter password to continue</p>
      </div>
      <div class="space-y-4">
        <input type="password" id="admin-password" placeholder="Password" 
               class="w-full px-4 py-3 rounded-lg bg-gray-800 border border-gray-700 text-white text-center text-lg tracking-widest focus:outline-none focus:border-emerald-500/50"
               onkeypress="if(event.key==='Enter')checkPassword()">
        <button onclick="checkPassword()" class="w-full py-3 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white font-semibold transition-colors">
          Login
        </button>
        <p id="login-error" class="text-red-400 text-sm text-center hidden">Wrong password!</p>
      </div>
    </div>
  </div>

  <!-- Admin Panel -->
  <div id="admin-panel" class="hidden">
    <header class="bg-gray-900 border-b border-gray-800 sticky top-0 z-40">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
        <div class="flex items-center space-x-3">
          <div class="w-8 h-8 rounded-lg bg-gradient-to-br from-emerald-500 to-cyan-500 flex items-center justify-center">
            <span class="text-white font-bold text-sm">A</span>
          </div>
          <h1 class="text-xl font-bold text-white">arsyny1x <span class="text-gray-500 font-normal">| Admin</span></h1>
        </div>
        <div class="flex items-center space-x-4">
          <button onclick="logout()" class="text-sm text-gray-400 hover:text-white transition-colors">Logout</button>
          <a href="index.html" target="_blank" class="text-sm text-gray-400 hover:text-white transition-colors">View Site â†’</a>
        </div>
      </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      
      <!-- Stats -->
      <div class="grid grid-cols-3 gap-4 mb-8">
        <div class="p-4 rounded-xl bg-gray-900/50 border border-gray-800">
          <div class="text-sm text-gray-400 mb-1">ğŸŸ¢ Online</div>
          <p class="text-2xl font-bold text-emerald-400" id="count-online">0</p>
        </div>
        <div class="p-4 rounded-xl bg-gray-900/50 border border-gray-800">
          <div class="text-sm text-gray-400 mb-1">ğŸŸ¡ Updating</div>
          <p class="text-2xl font-bold text-yellow-400" id="count-updating">0</p>
        </div>
        <div class="p-4 rounded-xl bg-gray-900/50 border border-gray-800">
          <div class="text-sm text-gray-400 mb-1">ğŸ”´ Patched</div>
          <p class="text-2xl font-bold text-red-400" id="count-patched">0</p>
        </div>
      </div>

      <!-- Tab Navigation -->
      <div class="flex space-x-1 mb-6 bg-gray-900/50 p-1 rounded-xl border border-gray-800">
        <button onclick="showTab('games')" id="tab-games" class="flex-1 py-2 px-4 rounded-lg bg-emerald-600 text-white font-medium transition-colors">
          ğŸ® Games
        </button>
        <button onclick="showTab('changelog')" id="tab-changelog" class="flex-1 py-2 px-4 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors">
          ğŸ“ Changelog
        </button>
      </div>

      <!-- Games Tab -->
      <div id="games-section" class="space-y-6">
        <!-- Add Game -->
        <div class="p-6 rounded-xl bg-gray-900/50 border border-gray-800">
          <h2 class="text-lg font-semibold text-white mb-4">Add New Game</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <input type="text" id="game-name" placeholder="Game Name *" class="px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-emerald-500/50">
            <select id="game-status" class="px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-emerald-500/50">
              <option value="online">ğŸŸ¢ Online</option>
              <option value="updating">ğŸŸ¡ Updating</option>
              <option value="patched">ğŸ”´ Patched</option>
            </select>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <input type="text" id="game-features" placeholder="Features (e.g. Auto Farm, ESP)" class="px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-emerald-500/50">
            <input type="url" id="game-image" placeholder="Image URL (optional)" class="px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-emerald-500/50">
          </div>
          <div id="image-preview" class="hidden mb-4">
            <p class="text-sm text-gray-400 mb-2">Preview:</p>
            <div class="w-48 h-28 rounded-lg overflow-hidden bg-gray-800 border border-gray-700">
              <img id="preview-img" src="" alt="Preview" class="w-full h-full object-cover">
            </div>
          </div>
          <button onclick="addGame()" id="add-btn" class="px-6 py-2 rounded-lg bg-emerald-600 hover:bg-emerald-500 text-white font-medium transition-colors">
            Add Game
          </button>
          <p id="game-error" class="mt-2 text-red-400 text-sm hidden"></p>
        </div>

        <!-- Games List -->
        <div class="rounded-xl bg-gray-900/50 border border-gray-800 overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-800 flex items-center justify-between">
            <h2 class="text-lg font-semibold text-white">Games</h2>
            <input type="text" id="search-games" placeholder="Search..." oninput="searchGames(this.value)" class="px-3 py-1.5 rounded-lg bg-gray-800 border border-gray-700 text-sm text-white focus:outline-none focus:border-emerald-500/50">
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-800/50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs text-gray-400 uppercase">Image</th>
                  <th class="px-6 py-3 text-left text-xs text-gray-400 uppercase">Game</th>
                  <th class="px-6 py-3 text-left text-xs text-gray-400 uppercase">Features</th>
                  <th class="px-6 py-3 text-left text-xs text-gray-400 uppercase">Status</th>
                  <th class="px-6 py-3 text-right text-xs text-gray-400 uppercase">Action</th>
                </tr>
              </thead>
              <tbody id="games-list" class="divide-y divide-gray-800">
                <tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <!-- Changelog Tab -->
      <div id="changelog-section" class="space-y-6 hidden">
        <!-- Add Changelog -->
        <div class="p-6 rounded-xl bg-gray-900/50 border border-gray-800">
          <h2 class="text-lg font-semibold text-white mb-4">Add Changelog Entry</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <select id="cl-game" class="px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-cyan-500/50">
              <option value="">ğŸ® Select Game (Optional)</option>
              <option value="global">ğŸŒ Global Update</option>
            </select>
            <select id="cl-type" class="px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-cyan-500/50">
              <option value="feature">âœ¨ New Feature</option>
              <option value="fix">ğŸ”§ Bug Fix</option>
              <option value="update">ğŸ“¦ Update</option>
              <option value="remove">ğŸ—‘ï¸ Removed</option>
            </select>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
            <input type="text" id="cl-version" placeholder="Version (e.g. v2.1.0) *" class="px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-cyan-500/50">
            <input type="text" id="cl-title" placeholder="Title *" class="px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-cyan-500/50">
          </div>
          <div class="mb-4">
            <textarea id="cl-description" placeholder="Description" rows="3" class="w-full px-4 py-2 rounded-lg bg-gray-800 border border-gray-700 text-white focus:outline-none focus:border-cyan-500/50 resize-none"></textarea>
          </div>
          <button onclick="addChangelog()" id="add-cl-btn" class="px-6 py-2 rounded-lg bg-cyan-600 hover:bg-cyan-500 text-white font-medium transition-colors">
            Add Changelog
          </button>
          <p id="cl-error" class="mt-2 text-red-400 text-sm hidden"></p>
        </div>

        <!-- Changelog List -->
        <div class="rounded-xl bg-gray-900/50 border border-gray-800 overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-800 flex items-center justify-between">
            <h2 class="text-lg font-semibold text-white">Changelog Entries</h2>
            <input type="text" id="search-cl" placeholder="Search..." oninput="searchChangelog(this.value)" class="px-3 py-1.5 rounded-lg bg-gray-800 border border-gray-700 text-sm text-white focus:outline-none focus:border-cyan-500/50">
          </div>
          <div class="overflow-x-auto">
            <table class="w-full">
              <thead class="bg-gray-800/50">
                <tr>
                  <th class="px-6 py-3 text-left text-xs text-gray-400 uppercase">Date</th>
                  <th class="px-6 py-3 text-left text-xs text-gray-400 uppercase">Version</th>
                  <th class="px-6 py-3 text-left text-xs text-gray-400 uppercase">Type</th>
                  <th class="px-6 py-3 text-left text-xs text-gray-400 uppercase">Title</th>
                  <th class="px-6 py-3 text-right text-xs text-gray-400 uppercase">Action</th>
                </tr>
              </thead>
              <tbody id="changelog-list" class="divide-y divide-gray-800">
                <tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

    </main>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 right-4 px-4 py-3 rounded-lg text-white transform translate-y-20 opacity-0 transition-all duration-300 z-50 bg-emerald-500"></div>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCTr7FaiVonN58y_satDITT3HjcBmwNY9Q",
      authDomain: "arsyny1x-hub.firebaseapp.com",
      databaseURL: "https://arsyny1x-hub-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "arsyny1x-hub",
      storageBucket: "arsyny1x-hub.firebasestorage.app",
      messagingSenderId: "167271191741",
      appId: "1:167271191741:web:af544285964ee6221e13d4"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    
    let gamesData = {};
    let changelogData = {};
    let sessionKey = null;

    // ==================== LOGIN SYSTEM ====================
    function checkPassword() {
      const input = document.getElementById('admin-password').value;
      const errorEl = document.getElementById('login-error');
      
      db.ref('config/adminPassword').once('value').then((snapshot) => {
        const correctPassword = snapshot.val();
        
        if (!correctPassword) {
          if (input === 'admin123') {
            db.ref('config/adminPassword').set('admin123');
            loginSuccess();
          } else {
            errorEl.classList.remove('hidden');
          }
          return;
        }
        
        if (input === correctPassword) {
          loginSuccess();
        } else {
          errorEl.classList.remove('hidden');
          setTimeout(() => errorEl.classList.add('hidden'), 3000);
        }
      });
    }

    function loginSuccess() {
      sessionKey = Math.random().toString(36).substring(2) + Date.now().toString(36);
      db.ref('config/adminSession').set({ key: sessionKey, time: Date.now() });
      document.getElementById('login-screen').classList.add('hidden');
      document.getElementById('admin-panel').classList.remove('hidden');
      loadGames();
      loadChangelog();
    }

    function logout() {
      db.ref('config/adminSession').remove();
      sessionKey = null;
      document.getElementById('admin-panel').classList.add('hidden');
      document.getElementById('login-screen').classList.remove('hidden');
      document.getElementById('admin-password').value = '';
    }

    function verifySession(callback) {
      if (!sessionKey) {
        showToast('Session expired. Please login again.', 'error');
        logout();
        return Promise.reject('No session');
      }
      return db.ref('config/adminSession/key').once('value').then((snapshot) => {
        if (snapshot.val() !== sessionKey) {
          showToast('Session expired. Please login again.', 'error');
          logout();
          throw new Error('Invalid session');
        }
        return callback();
      });
    }

    // ==================== TAB NAVIGATION ====================
    function showTab(tab) {
      if (tab === 'games') {
        document.getElementById('games-section').classList.remove('hidden');
        document.getElementById('changelog-section').classList.add('hidden');
        document.getElementById('tab-games').className = 'flex-1 py-2 px-4 rounded-lg bg-emerald-600 text-white font-medium transition-colors';
        document.getElementById('tab-changelog').className = 'flex-1 py-2 px-4 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors';
      } else {
        document.getElementById('games-section').classList.add('hidden');
        document.getElementById('changelog-section').classList.remove('hidden');
        document.getElementById('tab-games').className = 'flex-1 py-2 px-4 rounded-lg text-gray-400 hover:text-white hover:bg-gray-800 transition-colors';
        document.getElementById('tab-changelog').className = 'flex-1 py-2 px-4 rounded-lg bg-cyan-600 text-white font-medium transition-colors';
      }
    }

    // ==================== GAMES MANAGEMENT ====================
    function loadGames() {
      db.ref('games').on('value', (snapshot) => {
        gamesData = snapshot.val() || {};
        renderGames(gamesData);
        updateStats(gamesData);
        updateGameDropdown();
      });
    }

    function updateGameDropdown() {
      const select = document.getElementById('cl-game');
      // à¹€à¸à¹‡à¸šà¸„à¹ˆà¸²à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¹„à¸§à¹‰
      const selectedValue = select.value;
      
      // à¸¥à¹‰à¸²à¸‡ options à¸¢à¸à¹€à¸§à¹‰à¸™ 2 à¸­à¸±à¸™à¹à¸£à¸
      while (select.options.length > 2) {
        select.remove(2);
      }
      
      // à¹€à¸à¸´à¹ˆà¸¡à¹€à¸à¸¡à¹€à¸‚à¹‰à¸²à¹„à¸›
      Object.entries(gamesData).forEach(([id, game]) => {
        const option = document.createElement('option');
        option.value = id;
        option.textContent = `ğŸ® ${game.name || id}`;
        select.appendChild(option);
      });
      
      // à¸„à¸·à¸™à¸„à¹ˆà¸²à¸—à¸µà¹ˆà¹€à¸¥à¸·à¸­à¸à¹€à¸”à¸´à¸¡
      select.value = selectedValue;
    }

    function renderGames(games) {
      const tbody = document.getElementById('games-list');
      const entries = Object.entries(games);
      
      if (entries.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">No games yet. Add one!</td></tr>';
        return;
      }
      
      tbody.innerHTML = entries.map(([id, game]) => {
        const statusColors = {
          online: 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30',
          updating: 'bg-yellow-500/20 text-yellow-400 border-yellow-500/30',
          patched: 'bg-red-500/20 text-red-400 border-red-500/30'
        };

        const imageCell = game.image 
          ? `<div class="w-16 h-10 rounded bg-gray-800 overflow-hidden"><img src="${game.image}" class="w-full h-full object-cover" onerror="this.style.display='none'"></div>`
          : '<div class="w-16 h-10 rounded bg-gray-800 flex items-center justify-center text-gray-600 text-xs">No image</div>';

        return `
          <tr class="hover:bg-gray-800/30">
            <td class="px-6 py-4">${imageCell}</td>
            <td class="px-6 py-4">
              <input type="text" value="${game.name || id}" onchange="updateGame('${id}', 'name', this.value)" 
                     class="w-full px-2 py-1 rounded bg-gray-800 border border-gray-700 text-sm text-white focus:border-emerald-500/50 outline-none">
            </td>
            <td class="px-6 py-4">
              <input type="text" value="${game.features || ''}" onchange="updateGame('${id}', 'features', this.value)" 
                     class="w-full px-2 py-1 rounded bg-gray-800 border border-gray-700 text-sm text-gray-300 focus:border-emerald-500/50 outline-none">
            </td>
            <td class="px-6 py-4">
              <select onchange="updateGame('${id}', 'status', this.value)"
                      class="px-3 py-1.5 rounded-lg text-sm font-medium border ${statusColors[game.status]} bg-opacity-20 cursor-pointer focus:outline-none">
                <option value="online" ${game.status === 'online' ? 'selected' : ''}>ğŸŸ¢ Online</option>
                <option value="updating" ${game.status === 'updating' ? 'selected' : ''}>ğŸŸ¡ Updating</option>
                <option value="patched" ${game.status === 'patched' ? 'selected' : ''}>ğŸ”´ Patched</option>
              </select>
            </td>
            <td class="px-6 py-4 text-right">
              <button onclick="deleteGame('${id}')" class="text-red-400 hover:text-red-300 text-sm font-medium transition-colors">Delete</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function updateStats(games) {
      const stats = { online: 0, updating: 0, patched: 0 };
      Object.values(games).forEach(g => stats[g.status] = (stats[g.status] || 0) + 1);
      document.getElementById('count-online').textContent = stats.online;
      document.getElementById('count-updating').textContent = stats.updating;
      document.getElementById('count-patched').textContent = stats.patched;
    }

    document.getElementById('game-image')?.addEventListener('input', function() {
      const url = this.value.trim();
      const previewDiv = document.getElementById('image-preview');
      const previewImg = document.getElementById('preview-img');
      if (url) { previewImg.src = url; previewDiv.classList.remove('hidden'); }
      else { previewDiv.classList.add('hidden'); }
    });

    function addGame() {
      const name = document.getElementById('game-name').value.trim();
      const features = document.getElementById('game-features').value.trim();
      const status = document.getElementById('game-status').value;
      const image = document.getElementById('game-image').value.trim();
      const errorEl = document.getElementById('game-error');

      if (!name) { errorEl.textContent = 'Enter game name'; errorEl.classList.remove('hidden'); return; }

      const btn = document.getElementById('add-btn');
      btn.disabled = true; btn.textContent = 'Adding...';

      const id = name.toLowerCase().replace(/\s+/g, '-').replace(/[^a-z0-9-]/g, '');
      const gameData = { name: name, features: features || 'Auto Farm', status: status, updated: Date.now() };
      if (image) gameData.image = image;
      
      verifySession(() => db.ref(`games/${id}`).set(gameData))
        .then(() => {
          showToast('âœ… Game added!');
          document.getElementById('game-name').value = '';
          document.getElementById('game-features').value = '';
          document.getElementById('game-image').value = '';
          document.getElementById('image-preview').classList.add('hidden');
          errorEl.classList.add('hidden');
        })
        .catch(err => { if (err.message !== 'Invalid session') showToast('âŒ Error: ' + err.message, 'error'); })
        .finally(() => { btn.disabled = false; btn.textContent = 'Add Game'; });
    }

    function updateGame(id, field, value) {
      verifySession(() => db.ref(`games/${id}`).update({ [field]: value, updated: Date.now() }))
        .then(() => showToast('âœ… Saved!'))
        .catch(err => { if (err.message !== 'Invalid session') showToast('âŒ ' + err.message, 'error'); });
    }

    function deleteGame(id) {
      if (!confirm('Delete this game?')) return;
      verifySession(() => db.ref(`games/${id}`).remove())
        .then(() => showToast('âœ… Deleted!'))
        .catch(err => { if (err.message !== 'Invalid session') showToast('âŒ ' + err.message, 'error'); });
    }

    function searchGames(query) {
      const filtered = {};
      Object.entries(gamesData).forEach(([id, game]) => {
        if ((game.name || id).toLowerCase().includes(query.toLowerCase())) filtered[id] = game;
      });
      renderGames(filtered);
    }

    // ==================== CHANGELOG MANAGEMENT ====================
    function loadChangelog() {
      db.ref('changelog').on('value', (snapshot) => {
        changelogData = snapshot.val() || {};
        renderChangelog(changelogData);
      });
    }

    function renderChangelog(logs) {
      const tbody = document.getElementById('changelog-list');
      const entries = Object.entries(logs).sort((a, b) => b[1].date - a[1].date);
      
      if (entries.length === 0) {
        tbody.innerHTML = '<tr><td colspan="5" class="px-6 py-8 text-center text-gray-500">No changelog entries yet. Add one!</td></tr>';
        return;
      }

      const typeLabels = { feature: 'âœ¨ Feature', fix: 'ğŸ”§ Fix', update: 'ğŸ“¦ Update', remove: 'ğŸ—‘ï¸ Removed' };
      const typeColors = { feature: 'text-emerald-400', fix: 'text-blue-400', update: 'text-cyan-400', remove: 'text-red-400' };

      tbody.innerHTML = entries.map(([id, log]) => {
        const date = new Date(log.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
        const gameName = log.gameName || (log.gameId === 'global' ? 'ğŸŒ Global' : 'ğŸ® Unknown');
        return `
          <tr class="hover:bg-gray-800/30">
            <td class="px-6 py-4 text-gray-400 text-sm">${date}</td>
            <td class="px-6 py-4 text-white font-medium">${log.version}</td>
            <td class="px-6 py-4 ${typeColors[log.type] || 'text-gray-400'}">${typeLabels[log.type] || log.type}</td>
            <td class="px-6 py-4">
              <span class="text-cyan-400 text-xs block mb-1">${gameName}</span>
              <span class="text-gray-300">${log.title}</span>
            </td>
            <td class="px-6 py-4 text-right">
              <button onclick="deleteChangelog('${id}')" class="text-red-400 hover:text-red-300 text-sm font-medium">Delete</button>
            </td>
          </tr>
        `;
      }).join('');
    }

    function addChangelog() {
      const version = document.getElementById('cl-version').value.trim();
      const type = document.getElementById('cl-type').value;
      const title = document.getElementById('cl-title').value.trim();
      const description = document.getElementById('cl-description').value.trim();
      const gameId = document.getElementById('cl-game').value;
      const errorEl = document.getElementById('cl-error');

      if (!version || !title) { errorEl.textContent = 'Version and Title are required'; errorEl.classList.remove('hidden'); return; }

      const btn = document.getElementById('add-cl-btn');
      btn.disabled = true; btn.textContent = 'Adding...';

      const id = Date.now().toString();
      const logData = { version, type, title, description: description || '', date: Date.now() };
      
      // à¹€à¸à¸´à¹ˆà¸¡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¸¡à¸–à¹‰à¸²à¹€à¸¥à¸·à¸­à¸
      if (gameId && gameId !== 'global') {
        logData.gameId = gameId;
        const game = gamesData[gameId];
        if (game) logData.gameName = game.name;
      } else if (gameId === 'global') {
        logData.gameId = 'global';
        logData.gameName = 'Global';
      }
      
      verifySession(() => db.ref(`changelog/${id}`).set(logData))
        .then(() => {
          showToast('âœ… Changelog added!');
          document.getElementById('cl-version').value = '';
          document.getElementById('cl-title').value = '';
          document.getElementById('cl-description').value = '';
          document.getElementById('cl-game').value = '';
          errorEl.classList.add('hidden');
        })
        .catch(err => { if (err.message !== 'Invalid session') showToast('âŒ Error: ' + err.message, 'error'); })
        .finally(() => { btn.disabled = false; btn.textContent = 'Add Changelog'; });
    }

    function deleteChangelog(id) {
      if (!confirm('Delete this changelog entry?')) return;
      verifySession(() => db.ref(`changelog/${id}`).remove())
        .then(() => showToast('âœ… Deleted!'))
        .catch(err => { if (err.message !== 'Invalid session') showToast('âŒ ' + err.message, 'error'); });
    }

    function searchChangelog(query) {
      const filtered = {};
      Object.entries(changelogData).forEach(([id, log]) => {
        const gameName = log.gameName || '';
        if (log.title.toLowerCase().includes(query.toLowerCase()) || 
            log.version.toLowerCase().includes(query.toLowerCase()) ||
            gameName.toLowerCase().includes(query.toLowerCase())) {
          filtered[id] = log;
        }
      });
      renderChangelog(filtered);
    }

    function showToast(msg, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = msg;
      toast.className = `fixed bottom-4 right-4 px-4 py-3 rounded-lg text-white transform transition-all duration-300 z-50 ${type === 'error' ? 'bg-red-500' : 'bg-emerald-500'}`;
      toast.classList.remove('translate-y-20', 'opacity-0');
      setTimeout(() => toast.classList.add('translate-y-20', 'opacity-0'), 3000);
    }
  </script>
</body>
</html>
